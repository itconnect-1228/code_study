# TASK-066: 코드 복잡도 분석기 구현

**완료일**: 2025-12-25
**구현 파일**: `backend/src/services/code_analysis/complexity_analyzer.py`
**테스트 파일**: `backend/tests/unit/services/code_analysis/test_complexity_analyzer.py`

---

## 무엇을 만들었나요?

코드의 복잡도를 분석하는 서비스를 만들었습니다. 이 서비스는 사용자가 업로드한 코드가 얼마나 복잡한지 측정하고, "초급(beginner)", "중급(intermediate)", "고급(advanced)" 중 하나로 분류합니다.

쉽게 설명하면, 책의 난이도를 측정하는 것과 비슷합니다. 어린이 그림책은 "초급", 청소년 소설은 "중급", 전문 학술서는 "고급"으로 분류하는 것처럼요!

---

## 왜 이렇게 만들었나요?

1. **교육 목적**: 프로그래밍을 처음 배우는 사람에게 자신의 코드가 얼마나 복잡한지 알려주면, 학습 진행 상황을 파악하는 데 도움이 됩니다.

2. **다국어 지원**: Python, JavaScript, TypeScript, Java, C/C++ 등 여러 프로그래밍 언어를 지원해야 학습 플랫폼으로서 유용합니다.

3. **데이터 모델 연동**: `uploaded_code` 테이블의 `complexity_level` 필드에 저장되어 AI 문서 생성 시 난이도에 맞는 설명을 제공합니다.

---

## 어떻게 동작하나요?

### 측정하는 항목들

1. **줄 수 분석**: 전체 줄, 코드 줄, 주석 줄, 빈 줄을 각각 계산합니다.
   - 마치 책의 페이지 수를 세는 것과 같습니다.

2. **중첩 깊이**: 코드가 얼마나 깊이 들여쓰기 되어 있는지 측정합니다.
   - 마트료시카 인형처럼 상자 안에 상자가 있는 구조입니다.
   - Python은 들여쓰기로, JavaScript는 중괄호 `{}`로 측정합니다.

3. **함수/클래스 개수**: 코드에 정의된 함수와 클래스의 수를 셉니다.
   - 책의 장(chapter) 수를 세는 것과 비슷합니다.

### 복잡도 결정 공식

각 항목에 점수를 부여하고 합산합니다:
- 줄 수: 50줄 미만 = 0점, 50-200 = 1점, 200-500 = 2점, 500+ = 3점
- 중첩 깊이: 3 미만 = 0점, 3-4 = 1점, 5-6 = 2점, 6+ = 3점
- 함수 수: 5개 미만 = 0점, 5-15 = 1점, 15-30 = 2점, 30+ = 3점
- 클래스 수: 2개 미만 = 0점, 2-5 = 1점, 5-10 = 2점, 10+ = 3점

총점에 따른 분류:
- 0-3점: **초급 (Beginner)**
- 4-7점: **중급 (Intermediate)**
- 8점 이상: **고급 (Advanced)**

---

## 어떻게 테스트했나요? (TDD 사이클)

### RED 단계 (실패하는 테스트 작성)
먼저 35개의 테스트 케이스를 작성했습니다:
- `CodeComplexity` 데이터 클래스 테스트
- 줄 수 계산 테스트 (Python, JavaScript)
- 중첩 깊이 분석 테스트
- 함수/클래스 카운팅 테스트
- 복잡도 레벨 결정 테스트
- 통합 테스트 (실제 코드 분석)

### GREEN 단계 (구현)
모든 테스트를 통과하는 최소한의 코드를 작성했습니다.

### 결과
```
======================== 35 passed, 1 warning in 0.04s ========================
```

---

## 수정된 파일들

| 파일 | 변경 내용 |
|------|-----------|
| `backend/src/services/code_analysis/complexity_analyzer.py` | 새로 생성 - 복잡도 분석 로직 |
| `backend/src/services/code_analysis/__init__.py` | 새 모듈 export 추가 |
| `backend/tests/unit/services/code_analysis/test_complexity_analyzer.py` | 새로 생성 - 35개 테스트 케이스 |

---

## 관련 개념

- **정규 표현식 (Regex)**: 코드에서 함수/클래스 패턴을 찾는 데 사용
- **데이터 클래스 (Dataclass)**: Python의 `@dataclass` 데코레이터로 불변 객체 생성
- **열거형 (Enum)**: 복잡도 레벨을 명확하게 정의

---

## 주의사항

1. **언어 감지 필요**: 정확한 분석을 위해 `language_detector.py`로 먼저 언어를 감지하는 것을 권장합니다.

2. **정확도 한계**: 정규 표현식 기반 분석은 100% 정확하지 않을 수 있습니다. 예를 들어, 문자열 내부의 패턴을 잘못 감지할 수 있습니다.

3. **빈 코드 처리**: 빈 코드는 자동으로 "초급"으로 분류됩니다.

---

## 다음 단계

- T067: 파일 저장 서비스 구현 (`file_storage.py`)
- T068: TaskService 구현 (`task_service.py`)
- T069: CodeUploadService 구현 (`code_upload_service.py`)

복잡도 분석기는 이 후속 태스크들에서 업로드된 코드의 복잡도를 평가하는 데 사용됩니다.
